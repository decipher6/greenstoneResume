# Render Deployment Guide - Complete Instructions

## Render Configuration Fields

When setting up your backend on Render, use these **exact values**:

### 1. Build Command
```
pip install --upgrade pip && pip install -r requirements.txt
```
**Why**: Upgrades pip first to avoid compatibility issues, then installs all dependencies.

### 2. Pre-Deploy Command
```
(Leave this field EMPTY)
```
**Why**: No pre-deployment steps needed for this application.

### 3. Start Command
```
uvicorn main:app --host 0.0.0.0 --port $PORT
```
**Why**: This is the production-standard way to run FastAPI. Render provides `$PORT` automatically.

### 4. Auto-Deploy
```
On Commit
```
**Why**: Automatically deploys when you push to the configured branch (recommended).

### 5. Deploy Hook
```
(Leave as auto-generated by Render)
```
**Why**: Render generates this automatically. You can use it to trigger deployments via API.

---

## Additional Render Settings (Not in the image, but CRITICAL)

### Root Directory
```
backend
```
**Why**: Tells Render that your application code is in the `backend/` folder.

### Python Version
```
3.11
```
**Why**: Matches your local Python version and ensures compatibility.

### Branch
```
backend
```
**Why**: This is where your backend code lives.

---

## Environment Variables (MUST SET IN RENDER DASHBOARD)

Go to **Settings â†’ Environment** in your Render service and add:

1. **MONGODB_URI**
   - Value: Your MongoDB Atlas connection string
   - Example: `mongodb+srv://username:password@cluster.mongodb.net/`
   - **Keep this secret!**

2. **GROQ_API_KEY**
   - Value: Your Groq API key
   - Example: `gsk_your_actual_key_here`
   - **Keep this secret!**

3. **DATABASE_NAME**
   - Value: `greenstone_talent`
   - (Already set in render.yaml, but verify it's correct)

4. **CORS_ORIGINS**
   - Value: Your Vercel frontend URL(s)
   - Example: `https://your-frontend.vercel.app,https://your-frontend-git-main.vercel.app`
   - **Important**: Add both your production URL and preview URLs
   - Format: Comma-separated list (no spaces)

5. **DEBUG**
   - Value: `false`
   - (Already set in render.yaml)

---

## Step-by-Step Deployment Process

### Step 1: Prepare the Backend Branch

1. **Ensure all files are committed**:
   ```bash
   git checkout backend
   git add .
   git commit -m "Prepare backend for Render deployment"
   git push origin backend
   ```

2. **Verify these files exist**:
   - âœ… `render.yaml` (in root)
   - âœ… `requirements.txt` (in root - copy of backend/requirements.txt)
   - âœ… `backend/main.py`
   - âœ… `backend/models.py`
   - âœ… `backend/requirements.txt`
   - âœ… `backend/database.py`
   - âœ… `backend/routes/` (all route files)

### Step 2: Create Render Service

1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click **"New +"** â†’ **"Web Service"**
3. Connect your GitHub repository
4. Select repository: `greenstoneResume`
5. Select branch: `backend`

### Step 3: Configure Render Settings

Render should auto-detect `render.yaml` and pre-fill most settings. **Verify these**:

- **Name**: `greenstone-backend` (or your choice)
- **Region**: Choose closest to your users
- **Branch**: `backend`
- **Root Directory**: `backend`
- **Runtime**: `Python 3`
- **Build Command**: `pip install --upgrade pip && pip install -r requirements.txt`
- **Start Command**: `uvicorn main:app --host 0.0.0.0 --port $PORT`
- **Auto-Deploy**: `On Commit`

### Step 4: Set Environment Variables

**CRITICAL**: Go to **Environment** tab and add:

```
MONGODB_URI = mongodb+srv://your-connection-string
GROQ_API_KEY = gsk_your-actual-key
DATABASE_NAME = greenstone_talent
CORS_ORIGINS = https://your-frontend.vercel.app
DEBUG = false
```

**Note**: 
- Replace `your-connection-string` with your actual MongoDB URI
- Replace `gsk_your-actual-key` with your actual Groq API key
- Replace `your-frontend.vercel.app` with your actual Vercel frontend URL

### Step 5: Deploy

1. Click **"Create Web Service"**
2. Render will start building
3. Watch the build logs for any errors
4. Once deployed, note your backend URL: `https://your-backend.onrender.com`

### Step 6: Update Frontend

1. Go to your Vercel frontend project
2. Settings â†’ Environment Variables
3. Add/Update: `VITE_API_URL = https://your-backend.onrender.com/api`
4. Redeploy frontend

### Step 7: Update Backend CORS (If Needed)

If you get CORS errors:

1. Go to Render â†’ Your Backend Service â†’ Environment
2. Update `CORS_ORIGINS` to include your Vercel URL
3. Redeploy backend

---

## Verification Checklist

After deployment, verify:

- [ ] Backend health check: `https://your-backend.onrender.com/api/health`
- [ ] Backend returns: `{"status": "ok", ...}`
- [ ] Frontend can connect (check browser console)
- [ ] Login/Signup works
- [ ] No CORS errors in browser console
- [ ] API calls succeed

---

## Troubleshooting

### Build Fails: "Could not open requirements file"
- âœ… **Fixed**: `requirements.txt` is in root directory
- âœ… **Fixed**: `render.yaml` specifies `rootDir: backend`

### Build Fails: "metadata-generation-failed"
- âœ… **Fixed**: `sentence-transformers` is commented out in requirements.txt

### Build Fails: "ModuleNotFoundError: No module named 'models'"
- âœ… **Fixed**: `models.py` is in `backend/` directory

### Runtime Error: "Address already in use"
- âœ… **Fixed**: Using `$PORT` environment variable in start command

### CORS Errors
- Check `CORS_ORIGINS` includes your frontend URL
- Format: `https://frontend.vercel.app` (no trailing slash)
- Multiple origins: comma-separated, no spaces

### Backend Not Starting
- Check build logs in Render dashboard
- Verify all environment variables are set
- Check MongoDB connection string is correct
- Verify Groq API key is valid

---

## Expected Build Output

You should see:
```
==> Cloning from https://github.com/your-repo/greenstoneResume
==> Checking out commit abc123 in branch backend
==> Installing Python version 3.11
==> Running build command 'pip install --upgrade pip && pip install -r requirements.txt'
[notice] A new release of pip is available...
Successfully installed fastapi-0.104.1 uvicorn-0.24.0 ...
==> Starting service with 'uvicorn main:app --host 0.0.0.0 --port $PORT'
INFO:     Started server process
INFO:     Uvicorn running on http://0.0.0.0:PORT
âœ… Connected to MongoDB
âœ… Database indexes created
```

---

## Quick Reference: Render Field Values

| Field | Value |
|-------|-------|
| **Build Command** | `pip install --upgrade pip && pip install -r requirements.txt` |
| **Pre-Deploy Command** | *(empty)* |
| **Start Command** | `uvicorn main:app --host 0.0.0.0 --port $PORT` |
| **Auto-Deploy** | `On Commit` |
| **Root Directory** | `backend` |
| **Python Version** | `3.11` |
| **Branch** | `backend` |

---

## Next Steps After Deployment

1. âœ… Test backend: `curl https://your-backend.onrender.com/api/health`
2. âœ… Update Vercel frontend `VITE_API_URL`
3. âœ… Test full application flow
4. âœ… Monitor Render logs for any issues
5. âœ… Set up monitoring/alerts (optional)

---

**You're all set!** The backend branch is prepared and ready for deployment. ðŸš€

